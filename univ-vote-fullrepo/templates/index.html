<!doctype html>
<html>
<head>
  <meta charset='utf-8'>
  <title>UnivVote Prototype Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
  <h2>University Voting Prototype - Real-time Dashboard</h2>
  <div>
    <canvas id="pieChart" width="400" height="200"></canvas>
  </div>
  <script>
    const socket = io();
    let chart;
    function render(data){
      const labels = Object.keys(data).map(k=> 'Candidate '+k);
      const vals = Object.values(data);
      const ctx = document.getElementById('pieChart').getContext('2d');
      if(chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'pie',
        data: { labels: labels, datasets: [{ data: vals }] }
      });
    }
    socket.on('init', d=>{ render(d.counts); });
    socket.on('vote_update', d=>{ render(d.counts); });
    fetch('/results').then(r=>r.json()).then(j=>render(j.counts));
  </script>
</body>
</html>
